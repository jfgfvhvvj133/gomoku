c项目名称 ：基于 Linux GEC6818 开发板	电子相册

项目制作人 ：张涛

项目介绍 ：

​				项目实现功能：点击开始进入电子相册，在电子相册中可上下左右翻动相册图片，进入相册时背景音乐播放，点击退出图标可返回首页。

​				start	    ----------> 进入电子相册

​				向上滑动 ----------> 下一张图片（从下往上显示）

​				向下滑动 ----------> 上一张图片（从上往下显示）

​				向左滑动 ----------> 下一张图片（从右往左显示）

​				向右滑动 ----------> 上一张图片（从左往右显示）

​				退出        -----------> 返回首页

​				主要用到工具：Visual Studio Code ,VMware Workstation 16 Player,SecureCRT,GEC6818 开发板,网线

​				Visual Studio Code ：实现代码的编写

​				VMware Workstation 16 Playe ：实现代码编译

​				网线 ：Ubuntu 和 SecureCRT 形成局域网进行文件传输

​				SecureCRT ：主要实现将可执行文件传入GEC6818 开发板

​				GEC6818 开发板：显示效果

## 1. 建立源码工程

​	picture  : 工程文件夹

​		main.c	工程代码的入口

​		lcd.c/lcd.h	与屏幕操作相关的功能函数

​		bmp.c/bmp.h	与bmp图片解析相关的功能函数

​		touch.c/touch.h	与触摸屏操作相关的功能函数

​		filelist.c/filelist.h 	与图片文件操作相关的功能函数

​		pthread.c/pthread.h	与线程相关的功能函数

​		libs/	库文件目录 第三方库 保存需要的.so  .a 动静态库

​		inc/	头文件目录 第三方的库头文件,库文件需要的.h文件

​		Makefile	工程管理工具

​		Readme.doc 	说明文件

​		Changlog.log 	日志文件

## 2. 功能实现

实现的基本步骤：

	1. 初始化屏幕，初始化后就可以对屏幕进行操作
 	2. 建立一个链表存放图片的路径，以便显示图片时调用
 	3. 进入相册，同时会播放背景音乐
 	4. 根据浏览图片的操作实现不同的播放效果
 	5. 关闭映射和文件

### 2.1 屏幕操作

打开屏幕文件并进行内存映射

```c
/*
    lcd_init ：屏幕初始化
    返回值 ：
        无返回值
*/
void lcd_init(void);
```

在屏幕范围内显示像素点，相当于上色

```c
/*
    lcd_dsrw_point : 显示一个像素点的颜色
    @x : 像素点横坐标
    @y : 像素点纵坐标
    @color ： 像素点颜色值
    返回值 ：
        无返回值
*/
void lcd_draw_point(int x,int y,int color)
```

解除映射和关闭屏幕文件

```c
/*
    lcd_uinit ：解除映射和关闭文件
    返回值 ：
        无返回值
*/
void lcd_uinit();
```

### 2.2 bmp图片解析

对bmp文件进行解析，同时从下往上显示图片

```c
/*
    display_bmp :从下往上显示bmp图片
    @x0 : 图片的初始横坐标
    @y0 : 图片的初始纵坐标
    @bmpfile : 要显示哪个图片
    返回值 :
        返回 -1 文件打开失败
        返回 -2 不是BMP文件
        返回 -3 无色深
*/
int display_bmp(int x0,int y0,char* bmpfile);
```

对bmp文件进行解析，同时从上往下显示图片

```c
/*
    display_bmp2 :从上往下显示bmp图片
    @x0 : 图片的初始横坐标
    @y0 : 图片的初始纵坐标
    @bmpfile : 要显示哪个图片
    返回值 :
        返回 -1 文件打开失败
        返回 -2 不是BMP文件
        返回 -3 无色深
*/
int display_bmp2(int x0,int y0,char* bmpfile);
```

对bmp文件进行解析，同时从右向左显示图片

```c
/*
    display_bmp3 :从右向左显示bmp图片
    @x0 : 图片的初始横坐标
    @y0 : 图片的初始纵坐标
    @bmpfile : 要显示哪个图片
    返回值 :
        返回 -1 文件打开失败
        返回 -2 不是BMP文件
        返回 -3 无色深
*/
int display_bmp3(int x0,int y0,char* bmpfile);
```

对bmp文件进行解析，同时从左向右显示图片

```CQL
/*
    display_bmp4 : 从左向右显示bmp图片
    @x0 : 图片的初始横坐标
    @y0 : 图片的初始纵坐标
    @bmpfile : 要显示哪个图片
    返回值 :
        返回 -1 文件打开失败
        返回 -2 不是BMP文件
        返回 -3 无色深
*/
int display_bmp4(int x0,int y0,char* bmpfile);
```

### 2.3 触摸屏操作

点触屏幕，根据坐标系保存该点的坐标

```c
/*
    get_user_touch ：获取触摸屏坐标
    @x : 保存横坐标
    @y : 保存纵坐标
    返回值:
        无返回值
*/
void get_user_touch(int* x,int* y);
```

根据触摸屏坐标，读取两次坐标利用坐标差值判断手指滑动方向

```c
/*
    get_fingle_move : 获取手指移动方向
    返回值 ：
        返回 UP 1
        返回 DOWN 2
        返回 LEFT 3
        返回 RIGHT 4
        返回 -1   失败
        返回 0 按下退出按钮
*/
int get_fingle_move();
```

点触开始图标，进入电子相册,确定图标范围，若点触在该范围内，则进入相册

```c
/*
    get_button ：进入电子相册按键
    @l : 电子相册链表
    返回值 ：
        无返回值
*/
void get_button();
```

### 2.4 图片文件操作

本操作是将图片文件的路径存入链表中

创建头结点

```c
/*
    creat_cyclelist ：创建一个双向链表的头结点
    返回值 ：
        返回 头结点
*/
BiList* creat_cyclelist(void);
```

将数据结点插入到带头结点的双向链表中

```c
/*
    Insert ：插入数据结点
    @l : 头结点
    @p : 数据结点
    返回值 ：
        无返回值
*/
void  Insert(BiList* l,BiNode* p);
```

调用创建头结点和插入数据结点的功能函数创建保存图片文件路径的链表，图片文件路径通过读取存储图片文件的目录进行读取

```c
/*
    creat_list ：创建链表
    返回值 ：
        返回 链表的头结点
*/
BiList* creat_list(void);
```

### 2.5 创建线程

本操作是创建一个线程，实现在打开电子相册同时播放背景音乐

根据背景音乐的路径，运用linux下的一个音乐播放器madplay，利用system函数调用madplay播放器mp3音乐

```c
/*
    play_music ：播放音乐
    arg : 音乐的路径
    返回值 ：
        指针
*/
void* play_music(void* arg);
```

创建一个线程，本线程用于播放背景音乐

```c
/*
    create_pth : 创建线程
    返回值：
        返回 0 创建成功
        返回 -1 失败
*/
int create_pth(void);
```

## 3. 项目实现的过程中遇到的问题

1. 在构建存放图片路径的链表时，用于存放路径的的数据域使用的是char* 指针，导致最后只保存了最后一张图的路径

   解决方式 ：将原来使用的char*指针改用char型数组，避免了原来使用指针，在读取目录的过程中只更新了指向的对象而没有保存其内容的问题。

2. 在实现图片左右翻页发过程中，出现显示的图片与原图不符的情况，例如，失色、图片倾斜

   原因 ：在读取像素数组的数据时，少读取颜色值，或提前读取了颜色值导致图片倾斜

   解决方式 ：在实现从左往右显示和从右往左显示时，要按列依次显示，与像素数组按行存储有所不同，过程中需要准确的跳到下一个像素点并读取其颜色值。

   